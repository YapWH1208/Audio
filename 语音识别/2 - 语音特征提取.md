# 预处理
## 预加重
- 语音会受到唇端辐射一直，高频能量明显下降，故可采用于家中的方法补偿语音信号高频部分的振幅。$$x^{'}[n]=x[n]-ax[n-1]$$其中 $x[n]$ 为输入信号第 $n$ 个采样点，而 $a$ 为预加重系数，可取 $1$ 或比 $1$ 稍小的数值，一般取用 $a=0.97$ 。

## 分帧
- 语音信号是非平稳信号，为了得到相对稳定的信号会采取分帧策略，一般每帧帧长在于 20ms 或 25ms。假设采样率是 16kHz， 帧长为 25ms， 则一帧有 $16000 \times 0.025 = 400$ 个采样点。
- 由于可能存在两帧之间基音发生变化，为了确保声学特征的平滑性，一般采用重叠取帧的方法，即相邻两帧之间存在重叠部分（帧移一般在 10ms， 重叠 50%~60%）

## 加窗
- 用于限制信号在时间或频率上的有效范围
- 常用窗函数：
	- 矩形窗函数在时域上对信号进行有限截断，对应频域的通道较窄，边界处存在多个旁瓣，发生严重的频谱泄露。 $$w_{reg}[n]=\begin{cases}
	1&0\leq n\leq N-1\\
	0&n\leq0,n\geq N-1
	\end{cases}$$其中，$0\leqslant n\leqslant N-1$, $N$ 为窗的长度
	- 汉明窗函数$$w_{ham}[n]=0.54-0.46\cos(\frac{2\pi n}{N}-1)$$
	- 汉宁窗函数$$w_{han}[n]=0.5[1-\cos(\frac{2\pi n}{N}-1)]$$
	- 布莱克曼窗函数$$w_{bm}[n]=0.42-0.5\cos(\frac{2\pi}{N}n)0.008\cos(\frac{4\pi}{N}n)$$
- 考虑语音信号的短暂平稳性，对每帧语音信号进行加窗处理，得到短时间的语音信号 $x_l[n]$ ，其公式如下：$$x_l[n]=w[n]x[n+lL],\quad 0\leq n\leq N-1$$其中， $w[n]$ 是窗函数， $N$ 是窗长， $l$ 是帧索引， $L$ 是帧移

# 短时傅里叶变换
声音的分类：
- 纯音：只含一个频率的声音
- 复合音：除基音外，还包含多种倍音的声音


每个频率的信号都可以用正弦波表示，采用正弦函数建模$$e^{j\omega n}=\cos(\omega n)+j\sin(\omega n)$$正弦函数具有正交性，即任意两个不同频率的正弦波的乘积，在两者的公共周期内积分等于 $0$ 。正交性用复指数运算表示如下：$$\int^{+\infty}_{-\infty}e^{j\alpha t}e^{-j \beta t}dt=0,\quad \text{if }\alpha\neq\beta$$任何连续周期信号都可以由一组适当的正弦曲线组合而成。基于正弦函数的正交性，通过相关处理可以从语音信号分离出对应不同频率的正弦信号。


对于离散采样的语音信号，可以采用离散傅里叶变换（DFT）。离散傅里叶变换的第 $k$ 个点计算如下：$$X[k]=\sum^{N-1}_{n=0}x[n]e^{-\frac{j2\pi kn}{K}},\quad k=0,1,...,K-1$$其中， $x[n]$ 是时域波形第 $n$ 个采样点值， $X[k]$ 是第 $k$ 个点的傅里叶变换谱值， $N$ 是采样点序列的点数， $K$ 是频谱系数的点数， 且 $K\geq N$。


DFT系数通常是复数形式，因为$$e^{\frac{j2\pi kn}{K}}=\cos(\frac{2\pi kn}{K})-j\sin(\frac{2\pi kn}{K})$$所以$$X[k]=X_\text{real}[k]-jX_\text{image}[k]$$其中$$X_\text{real}[k]=\sum^{N-1}_{n=0}x[n]\cos(\frac{2\pi kn}{K})$$$$X_\text{image}[k]=\sum^{N-1}_{n=0}x[n]\sin(\frac{2\pi kn}{K})$$信号的频谱幅值表示：$$X_\text{magnitude}[k]=\sqrt{X_\text{real}[k]^2+X_\text{image}[k]^2}$$能量频谱用振幅频谱的平方表示：$$X_\text{power}[k]=X_\text{real}[k]^2+X_\text{image}[k]^2$$


通过对频域信号进行离散傅里叶变换（IDFT），可以恢复时域信号：$$x[n]=\frac{1}{K}\sum^{K-1}_{k=0}e^{\frac{j2\pi kn}{N}},\quad n=0,1,...,N-1$$在实际应用中，对语音信号进行分帧加窗处理，将其分割成一帧帧的离散序列，可视此为短时傅里叶变换（STFT）：$$X[k,l]=\sum^{N-1}_{n=0}x_l[n]e^{-\frac{j2\pi kn}{K}}=\sum^{N-1}_{n=0}w[n]x[n+lL]e^{-\frac{j2\pi kn}{K}}$$其中，$K$ 是离散傅里叶变换后的频率点个数， $k$ 是频率索引， $0\leq k < K$ 。 $X[k,l]$ 建立起索引为 $lL$ 的时域信号与索引为 $k$ 的频率信号的关系。对于采样率 $F_s$，相应的索引为时间 $\frac{lL}{F_s}$ 和频率 $\frac{kF_s}{2K}$。

# 听觉特性
> 幅度和音量成正比
> 频率和音调成正比；音调越高，声音越“尖”。

音调的单位是 $\text{mel}$ ，$\text{mel}$ 与传统频率 $f$ 的对应关系：$$\text{mel}(f)=2595\log(1+\frac{f}{700})$$
- 人类对不同频率的语音有不同的感知能力：
	- $1 \text{kHz}$ 以下，与频率呈线性关系
	- $1 \text{kHz}$ 以上，与频率呈对数关系

可见，人耳对低频信号比对高频信号更敏感。滤波器可以把不同频率的声音分隔出来，$\text{mel}$ 滤波器组的第 $m$ 个滤波函数 $H_m(k)$ 定义如下：$$H_m(k)\begin{cases}
0&k<k_{b_{m-1}}\\
\frac{k-k_{b_{m-1}}}{k_{b_m}-k_{b_{m-1}}}&k_{b_{m-1}}\leq k\leq k_{b_m}\\
1&k=k_{b_m}\\
\frac{k_{b_{m+1}}-k}{k_{b_{m+1}}-k_{b_m}}&k_{b_m}\leq k\leq k_{b_{m+1}}\\
0&k>k_{b_{m+1}}
\end{cases}$$
其中， $1\leq m\leq M$ ，$M$ 是滤波器的个数， $k_{b_m}$ 是滤波器的临界频率， $k$ 表示 $K$ 点离散傅里叶变换的频谱系数序号。 $k_{b_m}$ 可由下面的公式计算得到：$$\huge k_{b_m}=(\frac{K}{F_s})\cdot f^{-1}_\text{mel}(f_\text{mel}(f_\text{low})+\frac{m\cdot(f_\text{mel}(f_\text{high})-f_\text{mel}(f_\text{low}))}{M+1})$$其中， $f_\text{mel}()$ 表示频率到 $\text{mel}$ 频率的转换。 $K$ 是离散傅里叶变换的点数， $F_s$ 是采样率， $f_\text{low}$ 和 $f_\text{high}$ 是录波器上、下截止频率。函数 $f^{-1}_\text{mel}()$ 定义如下：$$f^{-1}_\text{mel}(f_\text{mel})=700\cdot(10^{\frac{f_\text{mel}}{2595}}-1)$$

# 线性预测
- 通过线性组合来估计一个信号的未来值的方法$$x[n]=e[n]*v[n]$$语音信号 $x[n]$ 可以被看成激励信号 $e[n]$ 与时变滤波器的单位取样响应 $v[n]$ 的卷积。

如果用一个全极点系统模拟激励产生语音的过程，设这个自回归模型（AR模型）的传递函数为：$$V(z)=\frac{X(z)}{E(z)}=\frac{G}{1-\sum^p_{i=1}a_iz^{-i}}=\frac{G}{A(z)}$$其中， $p$ 是阶数， $G$ 是增益。

因此，语音信号 $x[n]$ 和激励信号 $e[n]$ 之间的关系如下：$$x[n]=G\cdot e[n]+\sum^p_{i=1}a_ix[n-i]$$
可见语音信号采样点之间是有相关性的，可以使用若干个过去采样点的组合去预测未来的采样值。通过使线性预测的采样点值在最小均方误差约束下逼近实际采样点值，可以求出一组唯一的预测系数 $\{a_i\}$ ，简称线性预测编码（Linear Prediction Coding, LPC）系数。

在自回归模型参数估计过程中，定义线性预测器为：$$\hat x[n]=\sum^p_{i=1}a_ix[n-i]$$
预测误差 $\varepsilon[n]$ 为$$\varepsilon[n]=x[n]-\hat x[n]=x[n]-\sum^p_{i=1}a_ix[n-i]=Ge[n]$$定义某一帧内短时平均预测误差为$$E\{\varepsilon^2[n]\}=E\{(x[n]-\sum^p_{i=1}a_ix[n-i])^2\}$$
为了最小化误差，对 $a_j$ 求偏导，并令其为 $0$，有$$E\{(x[n]-\sum^p_{i=1}a_ix[n-i])x[n-j]\}=0, \quad j=1,2,...,p$$
从而计算出预测系数。

# 倒谱分析/同态滤波
- 采用时频变换，得到对数功率谱，再进行逆变换，分析出倒谱域的倒谱系数

同态滤波的过程：
1. 傅里叶变换：将时域的卷积信号转换为频域的乘积信号$$\text{DFT}(x[n])=X[z]=E[z]V[z]$$
2. 对数运算：将乘积信号转换为加性信号$$\log X[z]=\log E[z]+\log V[z]=\hat E[z]+\hat V[z]=\hat X[z]$$
3. 傅里叶逆变换：得到时域的语音信号倒谱$$Z^{-1}(\hat X[z])=Z^{-1}(\hat E[z]+\hat V[z])=\hat e[n]+\hat v[z]\approx\hat x[n]$$
对于低频部分，采用离散余弦逆变换替代傅里叶逆变换，可以直接获取低频倒谱系数，式子能这么表达：$$\hat c[m]=\sum^N_{k=1}\log X[k]\cos(\frac{\pi(k-0.5)m}{N}),\quad m=1,2,...,M$$
其中， $X[k]$ 是 $\text{DFT}$ 系数， $N$ 是 $\text{DFT}$ 系数的个数， $M$ 是 $\text{DFT}$ 系数的个数。

> $\text{DFT}$ 的不可逆性，从倒谱信号 $\hat c[m]$ 不可还原语音信号 $x[n]$ 

# 常用的声学特征
## FBank
FBank特征提取流程：
1. 将信息进行预加重、分帧、加汉明加窗处理，然后进行短时傅里叶变换（STFT），得到其频谱。
2. 求频谱平方，即能量谱，将每个滤波频带内的能量进行叠加，第 $k$ 个滤波器输出功率为 $X[k]$ 
3. 将每个滤波器的输出取对数，得到相应频带的对数功率谱。$$Y_\text{FBank}[k]=\log X[k]$$
FBank 经过了 $mel$ 滤波器组处理，抑制了一部分听觉无法感知的冗余信息。

## MFCC
MFCC 特征的计算过程：
1. 将信息进行预加重、分帧、加汉明加窗处理，然后进行短时傅里叶变换（STFT），得到其频谱。
2. 求频谱平方，即能量谱，将每个滤波频带内的能量进行叠加，第 $k$ 个滤波器输出功率为 $X[k]$ 
3. 将每个滤波器的输出取对数，得到相应频带的对数功率谱，并进行离散余弦逆变换，得到 $L$ 个 MFCC。$$C_n=\sum^M_{k=1}\log X[k]\cos(\frac{\pi(k-0.5)n}{M}),\quad n=1,2,...,L$$
4. 由上式计算得到 MFCC 特征，可将其作为静态特征，再对这种静态特征做一阶和二阶差分，得到相应的动态特征。

逆 Mel 频率倒谱系数（Inverted Mel-Frequency Cepstral Coefficient， IMFCC）特征的提取过程是在传统 MFCC 特征的基础上，对梅尔滤波器组的排列方式进行改造，使滤波器组在低频部分较为松散，在高频部分较为密集（与MFCC的滤波器组镜像对称）。

## PLP
PLP 是一种基于 Bark 听觉模型的特征参数，其采用线性预测方式实现语音信号的卷积处理

PLP 特征的提取过程：
1. 语音信号经过预加重、分帧、加窗。离散傅里叶变换收，取短时语音频谱的实部和虚部的平方和，得到短时功率谱 $X_\text{power}[k]$。
2. $$Z(f)=6\ln\{\frac{f}{600}+[(\frac{f}{600})^2+1]^{\frac12}\}$$根据上式转换得到 Bark 频率 $Z(f)$，一共划分为 $17$ 个 Bark 频带。将这 $17$ 个频带中每个频带内的短时功率谱与函数 $\psi(Z-Z_0(k))$ 相乘，求和后得到临界带宽听觉谱 $\theta(k)$。$$ \psi(Z-Z_0(k))=\begin{cases}
0&Z-Z_0(k)<-1.3\\
10\exp(Z-Z_0(k)+0.5)&-1.3\leqslant Z-Z_0(k)\leqslant-0.5\\
1&-0.5<Z-Z_0(k)\leqslant0.5\\
10\exp(Z-Z_0(k)-0.5)&0.5\leqslant Z-Z_0(k)\leqslant2.5\\
0&2.5<Z-Z_0(k)
\end{cases}$$$$\theta(k)=\sum^{2.5}_{Z-Z_0(k)=-1.3}p(f(Z))\psi(Z-Z_0(k)),\quad k=1,2,...,17$$其中，$Z_0(k)$ 表示第 $k$ 个临界频带的中心频带。
3. 用模拟人耳大约 $40dB$ 的等响度曲线 $E[f_0(k)]$ 对 $\theta(k)$ 进行等响度曲线预加重，即$$\Gamma(k)=E[f_0(k)]\theta(k),\quad k=1,2,...,17$$其中，$f_0(k)$ 表示第 $k$ 个临界频带的中心频率所对应的线性频率（单位为 $\text{Hz}$）$$E[f_0(k)]=\frac{(f_0(k)^2+1.44\times10^6)f_0(k)^4}{(f_0(k)^2+1.6\times10^5)^2(f_0(k)^2+9.61\times10^9)}$$
4. 为了近似模拟声音的强度与人耳感受的响度之剑的非线性关系，需要进行强度-响度转换（立方根压缩），公示如下：$$\theta(k)=\Gamma(k)^\frac13$$
5. 在进行强度-响度转换之后，需要进行连傅里叶逆变换。
6. 经过离散傅里叶逆变换后，用 $\text{Durbin}$ 算法计算 $12$ 阶全极点模型，并求出 $16$ 阶倒谱系数，即 $\text{PLP}$ 特征参数。

## 小总结
> FBank 保留更多的原始特征，MFCC去相关性较好，而PLP抗噪性更强

| 特征提取方法 | 表示方式 | 信息提取角度 | 计算复杂度 |
|--------------|--------|-------------|------------|
| FBank         | 滤波器组能量分布 | 频率域上的能量分布 | 相对较低 |
| MFCC         | 梅尔倒谱系数 | 在Mel频率域内的信息 | 相对较高 |
| PLP          | 滤波器组线性预测 | 结合线性预测和梅尔频率滤波 | 较低，通常低于MFCC |
